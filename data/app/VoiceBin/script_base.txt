local function getToolName(st)
    for key, v in pairs(st['Tools']) do
        if (type(v) == 'table') and (v['Inputs'] ~= nil) then
            return key
        end
    end
    return nil
end

local function setJimaku(txt, color, setting_path)
    local projectManager = resolve:GetProjectManager()
    local project = projectManager:GetCurrentProject()
    if not project then
        return
    end
    local timeline = project:GetCurrentTimeline()
    if not timeline then
        return
    end
    local mov = timeline:GetCurrentVideoItem()
    if not mov then
        return
    end
    if color ~= 'None' then
        mov:GetMediaPoolItem():SetClipColor(color)
    end

    -- Fusion
    -- AddFusionComp()で作ったものはエディダページで更新されないので
    -- compを作って保存、エディタページでimportしてみたけど変らん

    local comp
    if mov:GetFusionCompCount() > 0 then
        comp = mov:GetFusionCompByIndex(1)
    else
        comp = mov:AddFusionComp()
    end
    comp:StartUndo('add text')
    comp:Lock()
    local tool = comp:AddTool('TextPlus')

    local lst = comp:GetToolList(false, 'MediaOut')
    if lst[1] then
        lst[1]:Delete()
    end

    local mediaOut = comp:AddTool('MediaOut')
    mediaOut:ConnectInput('Input', tool)

    -- setting
    tool.StyledText = txt
    tool.UseFrameFormatSettings = 0
    tool.Width = tonumber(timeline:GetSetting('timelineResolutionWidth'))
    tool.Height = tonumber(timeline:GetSetting('timelineResolutionHeight'))

    local st = tool:SaveSettings()
    local f_st = bmd.readfile(setting_path)
    local name = getToolName(f_st)
    for i, key in pairs({ 'StyledText', 'UseFrameFormatSettings', 'Width', 'Height' }) do
        f_st['Tools'][name]['Inputs'][key] = st['Tools'][tool.Name]['Inputs'][key]
    end
    tool:LoadSettings(f_st)
    comp:Unlock()
    comp:EndUndo(true)
    print('Dane!')
end

setJimaku(
        [[%s]],
        '%s',
        [[%s]]
)